# qyl Project Structure (AI-Readable)
# Generated: 2025-12-13
# Source of truth: /CLAUDE.md

meta:
  name: qyl
  description: AI observability platform for OpenTelemetry + gen_ai.* (SemConv 1.38)
  target_framework: net10.0
  language_version: "C# 14"
  otel_semconv_version: "1.38.0"

system_components:
  count: 4

  qyl.protocol:
    path: src/qyl.protocol
    type: class_library
    purpose: Shared contracts + primitives (LEAF)
    key_files:
      - Attributes/GenAiAttributes.cs
      - Models/SpanRecord.cs
      - Models/SessionSummary.cs
      - Primitives/SessionId.cs
      - Primitives/UnixNano.cs

  qyl.collector:
    path: src/qyl.collector
    type: web_api
    purpose: OTLP ingest + DuckDB storage + REST/SSE
    ports:
      http_api: 5100
      otlp_grpc: 4317
      otlp_http: 4318
    key_files:
      - Storage/DuckDbSchema.cs
      - Storage/DuckDbStore.cs
      - Query/SessionQueryService.cs
      - Realtime/
      - Program.cs

  qyl.mcp:
    path: src/qyl.mcp
    type: console_app
    purpose: MCP tools; HTTP client to collector (no DB access)
    transport: stdio
    key_files:
      - Tools/TelemetryTools.cs
      - Tools/TelemetryJsonContext.cs
      - Program.cs

  qyl.dashboard:
    path: src/qyl.dashboard
    type: spa
    purpose: React UI; REST + SSE client to collector
    key_paths:
      - src/types/generated/
      - src/hooks/
      - src/pages/

dependency_graph:
  - qyl.dashboard -> qyl.collector: HTTP_ONLY
  - qyl.mcp -> qyl.collector: HTTP_ONLY
  - qyl.collector -> qyl.protocol: ProjectReference
  - qyl.mcp -> qyl.protocol: ProjectReference

single_source_rules:
  duckdb_schema: src/qyl.collector/Storage/DuckDbSchema.cs
  session_aggregation: src/qyl.collector/Query/SessionQueryService.cs
  genai_constants: src/qyl.protocol/Attributes/GenAiAttributes.cs
  dashboard_generated_types: src/qyl.dashboard/src/types/generated/
