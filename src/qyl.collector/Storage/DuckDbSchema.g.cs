// <auto-generated>
//     This code was generated by qyl.build (DuckDbGenerator).
//     Do not edit this file manually - changes will be overwritten.
//
//     Source:    eng/build/Domain/CodeGen/QylSchema.cs
//     Generator: DuckDbGenerator
//     Output:    DuckDbSchema.g.cs
//     Generated: 2026-01-13T01:08:46.8080440Z
// </auto-generated>

#nullable enable

using System;
using System.Collections.Frozen;
using System.Collections.Generic;
using Models = qyl.protocol.Models;

namespace qyl.collector.Storage;

/// <summary>
/// DuckDB schema mappings for type-safe column access.
/// </summary>
public static partial class DuckDbSchema
{
    #region Table Names

    /// <summary>Table: Primary span storage table</summary>
    public const string SpansTable = "spans";
    /// <summary>Table: Materialized view for session aggregation</summary>
    public const string SessionsAggTable = "sessions_agg";

    #endregion

    #region Spans Columns

    /// <summary>Column mappings for spans table.</summary>
    public static class Spans
    {
        /// <summary>Trace ID (32 hex chars) (VARCHAR)</summary>
        public const string TraceId = "trace_id";
        /// <summary>Span ID (16 hex chars) (VARCHAR)</summary>
        public const string SpanId = "span_id";
        /// <summary>Parent span ID (null for root spans) (VARCHAR)</summary>
        public const string ParentSpanId = "parent_span_id";
        /// <summary>Session ID for grouping related traces (VARCHAR)</summary>
        public const string SessionId = "session_id";
        /// <summary>Span name/operation (VARCHAR)</summary>
        public const string Name = "name";
        /// <summary>Service name from resource attributes (VARCHAR)</summary>
        public const string ServiceName = "service_name";
        /// <summary>Span kind (0=Unspecified, 1=Internal, 2=Server, 3=Client, 4=Producer, 5=Consumer) (TINYINT)</summary>
        public const string Kind = "kind";
        /// <summary>Start time in Unix nanoseconds (UBIGINT)</summary>
        public const string StartTimeUnixNano = "start_time_unix_nano";
        /// <summary>End time in Unix nanoseconds (UBIGINT)</summary>
        public const string EndTimeUnixNano = "end_time_unix_nano";
        /// <summary>Status code (0=Unset, 1=Ok, 2=Error) (TINYINT)</summary>
        public const string StatusCode = "status_code";
        /// <summary>Status message (for errors) (VARCHAR)</summary>
        public const string StatusMessage = "status_message";
        /// <summary>Span events as JSON (JSON)</summary>
        public const string EventsJson = "events_json";
        /// <summary>Span links as JSON (JSON)</summary>
        public const string LinksJson = "links_json";

        /// <summary>All column names.</summary>
        public static FrozenSet<string> AllColumns { get; } = new HashSet<string>
        {
            TraceId,
            SpanId,
            ParentSpanId,
            SessionId,
            Name,
            ServiceName,
            Kind,
            StartTimeUnixNano,
            EndTimeUnixNano,
            StatusCode,
            StatusMessage,
            EventsJson,
            LinksJson,
        }.ToFrozenSet();

        /// <summary>Maps C# property names to DuckDB column names.</summary>
        public static FrozenDictionary<string, string> PropertyToColumn { get; } = new Dictionary<string, string>
        {
            [nameof(Models.SpanRecord.TraceId)] = TraceId,
            [nameof(Models.SpanRecord.SpanId)] = SpanId,
            [nameof(Models.SpanRecord.ParentSpanId)] = ParentSpanId,
            [nameof(Models.SpanRecord.SessionId)] = SessionId,
            [nameof(Models.SpanRecord.Name)] = Name,
            [nameof(Models.SpanRecord.ServiceName)] = ServiceName,
            [nameof(Models.SpanRecord.Kind)] = Kind,
            [nameof(Models.SpanRecord.StartTimeUnixNano)] = StartTimeUnixNano,
            [nameof(Models.SpanRecord.EndTimeUnixNano)] = EndTimeUnixNano,
            [nameof(Models.SpanRecord.StatusCode)] = StatusCode,
            [nameof(Models.SpanRecord.StatusMessage)] = StatusMessage,
            [nameof(Models.SpanRecord.EventsJson)] = EventsJson,
            [nameof(Models.SpanRecord.LinksJson)] = LinksJson,
        }.ToFrozenDictionary();

        /// <summary>INSERT statement with all columns.</summary>
        public const string InsertSql = @"
INSERT INTO spans (
    trace_id,
    span_id,
    parent_span_id,
    session_id,
    name,
    service_name,
    kind,
    start_time_unix_nano,
    end_time_unix_nano,
    status_code,
    status_message,
    events_json,
    links_json
) VALUES (
    $1,
    $2,
    $3,
    $4,
    $5,
    $6,
    $7,
    $8,
    $9,
    $10,
    $11,
    $12,
    $13
)";

        /// <summary>SELECT * statement.</summary>
        public const string SelectAllSql = "SELECT * FROM spans";

        /// <summary>SELECT by primary key.</summary>
        public const string SelectByIdSql = "SELECT * FROM spans WHERE span_id = $1";

    }

    #endregion

    #region GenAI Attribute Mappings

    /// <summary>Maps OTel gen_ai.* attribute keys to promoted column names.</summary>
    public static FrozenDictionary<string, string> GenAiAttributeToColumn { get; } = new Dictionary<string, string>
    {
        ["gen_ai.provider.name"] = "gen_ai_system",
        ["gen_ai.request.model"] = "gen_ai_request_model",
        ["gen_ai.request.temperature"] = "gen_ai_temperature",
        ["gen_ai.response.finish_reason"] = "gen_ai_stop_reason",
        ["gen_ai.response.model"] = "gen_ai_response_model",
        ["gen_ai.system"] = "gen_ai_system",
        ["gen_ai.tool.call.id"] = "gen_ai_tool_call_id",
        ["gen_ai.tool.name"] = "gen_ai_tool_name",
        ["gen_ai.usage.completion_tokens"] = "gen_ai_output_tokens",
        ["gen_ai.usage.input_tokens"] = "gen_ai_input_tokens",
        ["gen_ai.usage.output_tokens"] = "gen_ai_output_tokens",
        ["gen_ai.usage.prompt_tokens"] = "gen_ai_input_tokens",
        ["qyl.cost.usd"] = "gen_ai_cost_usd",
        ["qyl.session.id"] = "session_id",
    }.ToFrozenDictionary();

    #endregion

    #region DDL

    /// <summary>Full schema DDL for initialization.</summary>
    public const string SchemaDdl = @"
CREATE TABLE IF NOT EXISTS spans (
    trace_id VARCHAR NOT NULL,
    span_id VARCHAR NOT NULL,
    parent_span_id VARCHAR,
    session_id VARCHAR,
    name VARCHAR NOT NULL,
    service_name VARCHAR,
    kind TINYINT NOT NULL,
    start_time_unix_nano UBIGINT NOT NULL,
    end_time_unix_nano UBIGINT NOT NULL,
    status_code TINYINT NOT NULL,
    status_message VARCHAR,
    events_json JSON,
    links_json JSON,
    PRIMARY KEY (span_id)
);

CREATE INDEX IF NOT EXISTS idx_spans_trace_id ON spans(trace_id);
CREATE INDEX IF NOT EXISTS idx_spans_service ON spans(service_name);
CREATE INDEX IF NOT EXISTS idx_spans_start_time ON spans(start_time_unix_nano DESC);
CREATE INDEX IF NOT EXISTS idx_spans_session ON spans(session_id);
";

    #endregion
}
