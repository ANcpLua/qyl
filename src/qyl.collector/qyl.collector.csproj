<Project Sdk="ANcpLua.NET.Sdk.Web">

  <PropertyGroup>
    <RootNamespace>qyl.collector</RootNamespace>
    <DockerDefaultTargetOS>Linux</DockerDefaultTargetOS>
    <PublishAot>true</PublishAot>
    <LangVersion>14</LangVersion>
    <InvariantGlobalization>true</InvariantGlobalization>
    <!-- CA2007: ConfigureAwait not needed in ASP.NET Core apps (no SynchronizationContext) -->
    <!-- NU1510: HealthChecks used via DI/abstractions, AOT pruner can't detect -->
    <NoWarn>$(NoWarn);CA2007;NU1510</NoWarn>
  </PropertyGroup>

  <!-- Expose internals to test project -->
  <ItemGroup>
    <InternalsVisibleTo Include="qyl.collector.tests"/>
  </ItemGroup>

  <!-- CLAUDE.md v2: Enable generation with rich metadata -->
  <!-- Set GenerateClaudeMd=true to enable auto-generation from these properties -->
  <!-- Currently using hand-written CLAUDE.md (richer content) -->
  <!--
  <PropertyGroup>
    <GenerateClaudeMd>true</GenerateClaudeMd>
    <ClaudePurpose>Backend service. This IS qyl from user perspective.</ClaudePurpose>
    <ClaudeRole>primary-runtime</ClaudeRole>
  </PropertyGroup>
  -->

  <!-- DuckDB for embedded columnar storage -->
  <ItemGroup>
    <PackageReference Include="DuckDB.NET.Data.Full"/>
  </ItemGroup>


  <!-- OTLP protobuf ingestion -->
  <ItemGroup>
    <PackageReference Include="Google.Protobuf"/>
    <PackageReference Include="Grpc.AspNetCore"/>
    <PackageReference Include="Grpc.Tools"/>
    <!-- ILCompiler is implicitly provided by SDK when PublishAot=true -->
    <PackageReference Include="OpenTelemetry.Api"/>
    <PackageReference Include="OpenTelemetry.Exporter.OpenTelemetryProtocol"/>
    <PackageReference Include="System.IO.Hashing"/>
  </ItemGroup>

  <!-- .NET 10 Telemetry: Source generators, enrichment, redaction, buffering (in Telemetry pkg) -->
  <ItemGroup>
    <PackageReference Include="Microsoft.Extensions.Telemetry"/>
    <PackageReference Include="Microsoft.Extensions.Telemetry.Abstractions"/>
    <PackageReference Include="Microsoft.Extensions.Compliance.Abstractions"/>
    <PackageReference Include="Microsoft.Extensions.Compliance.Redaction"/>
    <PackageReference Include="Microsoft.AspNetCore.Diagnostics.Middleware"/>
    <PackageReference Include="Microsoft.Extensions.Diagnostics.HealthChecks"/>
    <PackageReference Include="Microsoft.Extensions.Diagnostics.HealthChecks.Common"/>
    <PackageReference Include="Microsoft.Extensions.Diagnostics.HealthChecks.ResourceUtilization"/>
    <PackageReference Include="Microsoft.Extensions.Diagnostics.ResourceMonitoring"/>
    <PackageReference Include="Microsoft.Extensions.Http.Diagnostics"/>
  </ItemGroup>

  <!-- .NET 10 DI Lifecycle: AsyncState, auto-activation, object pooling -->
  <ItemGroup>
    <PackageReference Include="Microsoft.Extensions.DependencyInjection.AutoActivation"/>
    <PackageReference Include="Microsoft.Extensions.AsyncState"/>
    <PackageReference Include="Microsoft.Extensions.ObjectPool.DependencyInjection"/>
  </ItemGroup>

  <!-- Core dependencies -->
  <ItemGroup>
    <ProjectReference Include="..\qyl.protocol\qyl.protocol.csproj"/>
  </ItemGroup>

  <!-- Source generators (compile-time only) -->
  <ItemGroup>
    <ProjectReference Include="..\qyl.instrumentation.generators\qyl.instrumentation.generators.csproj"
                      OutputItemType="Analyzer"
                      ReferenceOutputAssembly="false"/>
  </ItemGroup>

</Project>
