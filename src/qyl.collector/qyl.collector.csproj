<Project Sdk="ANcpLua.NET.Sdk.Web">

  <PropertyGroup>
    <RootNamespace>qyl.collector</RootNamespace>
    <DockerDefaultTargetOS>Linux</DockerDefaultTargetOS>
    <PublishAot>true</PublishAot>
    <InvariantGlobalization>true</InvariantGlobalization>
    <!-- ConfigureAwait not needed in ASP.NET Core apps -->
    <NoWarn>$(NoWarn);CA2007;VSTHRD111</NoWarn>
    <!-- Enable CLAUDE.md generation to test all 3 item types -->
    <InjectClaudeBrain>true</InjectClaudeBrain>
  </PropertyGroup>

  <!-- SDK Throw class global using -->
  <ItemGroup>
    <Using Include="Microsoft.Shared.Diagnostics"/>
  </ItemGroup>

  <ItemGroup>
    <ClaudeCriticalFile Include="Storage/DuckDbStore.cs" Reason="Core persistence - schema changes break data"/>
    <ClaudeCriticalFile Include="Storage/DuckDbSchema.cs" Reason="DDL definitions - must match DuckDbStore"/>
    <ClaudeCriticalFile Include="Program.cs" Reason="DI registration - service configuration"/>
    <ClaudeAntiPattern Include="DateTime.UtcNow" UseInstead="TimeProvider.System.GetUtcNow()" Severity="Error"/>
    <ClaudeAntiPattern Include="object _lock" UseInstead="Lock _lock = new()" Severity="Error"/>
    <ClaudeRequiredPattern Include="Lock" Description="Use .NET 9+ Lock class for all synchronization"/>
    <ClaudeRequiredPattern Include="TypedResults.ServerSentEvents" Description="Use for all SSE endpoints"/>
  </ItemGroup>

  <!-- DuckDB for embedded columnar storage -->
  <ItemGroup>
    <PackageReference Include="DuckDB.NET.Data.Full"/>
  </ItemGroup>


  <!-- OTLP protobuf ingestion -->
  <ItemGroup>
    <PackageReference Include="Google.Protobuf"/>
    <PackageReference Include="Grpc.AspNetCore"/>
    <PackageReference Include="OpenTelemetry.Api"/>
    <PackageReference Include="System.IO.Hashing"/>
  </ItemGroup>

  <!-- Core dependencies -->
  <ItemGroup>
    <ProjectReference Include="..\qyl.protocol\qyl.protocol.csproj"/>
  </ItemGroup>

</Project>
