// =============================================================================
// qyl.instrumentation.generators - DuckDB Attributes
// Marks types and properties for DuckDB code generation
// Owner: qyl.instrumentation.generators
// =============================================================================

namespace qyl.instrumentation.generators.DuckDb;

/// <summary>
///     Source code for DuckDB attributes emitted via PostInitializationOutput.
///     These attributes mark types for DuckDB helper generation.
/// </summary>
internal static class DuckDbAttributeSource
{
    public const string Source = """
                                 // <auto-generated/>
                                 // DuckDB code generation attributes

                                 #nullable enable

                                 namespace qyl.collector.Storage;

                                 /// <summary>
                                 /// Marks a partial type for DuckDB helper generation.
                                 /// Generator will create AddParameters, MapFromReader, and column constants.
                                 /// </summary>
                                 [System.AttributeUsage(System.AttributeTargets.Class | System.AttributeTargets.Struct, AllowMultiple = false)]
                                 internal sealed class DuckDbTableAttribute : System.Attribute
                                 {
                                     /// <summary>Table name in DuckDB.</summary>
                                     public string TableName { get; }

                                     /// <summary>Optional ON CONFLICT clause for upsert behavior.</summary>
                                     public string? OnConflict { get; set; }

                                     public DuckDbTableAttribute(string tableName) => TableName = tableName;
                                 }

                                 /// <summary>
                                 /// Marks a property for DuckDB column mapping.
                                 /// If not specified, property name is converted to snake_case.
                                 /// </summary>
                                 [System.AttributeUsage(System.AttributeTargets.Property, AllowMultiple = false)]
                                 internal sealed class DuckDbColumnAttribute : System.Attribute
                                 {
                                     /// <summary>Column name in DuckDB (defaults to snake_case of property name).</summary>
                                     public string? ColumnName { get; }

                                     /// <summary>Set true for UBIGINT columns that need decimal conversion.</summary>
                                     public bool IsUBigInt { get; set; }

                                     /// <summary>Set true to exclude from INSERT (e.g., auto-generated columns).</summary>
                                     public bool ExcludeFromInsert { get; set; }

                                     /// <summary>Column ordinal for SELECT mapping (auto-assigned if not specified).</summary>
                                     public int Ordinal { get; set; } = -1;

                                     public DuckDbColumnAttribute() { }
                                     public DuckDbColumnAttribute(string columnName) => ColumnName = columnName;
                                 }

                                 /// <summary>
                                 /// Marks a property to be excluded from DuckDB mapping entirely.
                                 /// </summary>
                                 [System.AttributeUsage(System.AttributeTargets.Property, AllowMultiple = false)]
                                 internal sealed class DuckDbIgnoreAttribute : System.Attribute { }
                                 """;
}
