<Project Sdk="ANcpLua.NET.Sdk">

  <PropertyGroup>
    <RuntimeIdentifiers>win-x64;win-arm64;osx-arm64;linux-x64;linux-arm64;linux-musl-x64</RuntimeIdentifiers>
    <OutputType>Exe</OutputType>

    <!-- Suppress A2A package AOT warnings - their JsonContext is private so we can't use it directly -->

    <!-- Set up the NuGet package to be an MCP server -->
    <PackAsTool>true</PackAsTool>
    <PackageType>McpServer</PackageType>

    <!-- Set up the MCP server to be a self-contained application during publish only -->
    <PublishSelfContained>true</PublishSelfContained>
    <PublishSingleFile>true</PublishSingleFile>
    <PublishAot>true</PublishAot>
    <InvariantGlobalization>true</InvariantGlobalization>

    <!-- Package metadata -->
    <PackageReadmeFile>README.md</PackageReadmeFile>
    <PackageId>qyl.mcp</PackageId>
    <PackageVersion>0.1.0-beta</PackageVersion>
    <PackageTags>AI; MCP; server; stdio</PackageTags>
    <Description>An MCP server using the MCP C# SDK.</Description>
  </PropertyGroup>

  <!-- SDK Throw class global using -->
  <ItemGroup>
    <Using Include="Microsoft.Shared.Diagnostics"/>
  </ItemGroup>

  <ItemGroup>
    <None Include=".mcp\server.json" Pack="true" PackagePath="/.mcp/"/>
    <None Include="README.md" Pack="true" PackagePath="/"/>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Agents.AI"/>
    <PackageReference Include="Microsoft.Agents.AI.A2A"/>
    <PackageReference Include="Microsoft.Agents.AI.Abstractions"/>
    <PackageReference Include="Microsoft.Agents.AI.Hosting.A2A"/>
    <PackageReference Include="Microsoft.Agents.AI.Hosting.A2A.AspNetCore"/>
    <!-- ILCompiler is implicitly provided by SDK when PublishAot=true -->
    <PackageReference Include="Microsoft.Extensions.Hosting"/>
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions"/>
    <!-- Microsoft.NET.ILLink.Tasks is implicitly provided by SDK when PublishAot=true -->
    <PackageReference Include="ModelContextProtocol"/>
    <PackageReference Include="System.ClientModel"/>
    <PackageReference Include="OpenTelemetry.Api"/>
    <PackageReference Include="System.IO.Hashing"/>
    <PackageReference Include="Microsoft.Extensions.Http"/>
    <PackageReference Include="Microsoft.Extensions.Http.Diagnostics"/>
    <PackageReference Include="Microsoft.Extensions.Http.Resilience"/>
  </ItemGroup>

  <!-- Reference protocol only - communicate with collector via HTTP -->
  <ItemGroup>
    <ProjectReference Include="..\qyl.protocol\qyl.protocol.csproj"/>
  </ItemGroup>

</Project>
