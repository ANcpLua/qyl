# =============================================================================
# qyl EditorConfig - ROOT (Formatting + Path Exceptions)
# =============================================================================
# Baseline analyzer severities are in .globalconfig
# This file handles formatting + path-based overrides only
# =============================================================================

root = true

[*]
indent_style = space
indent_size = 4
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

# =============================================================================
# C# FILES - FORMATTING
# =============================================================================

[*.cs]
dotnet_sort_system_directives_first = true
dotnet_separate_import_directive_groups = false

# =============================================================================
# ANcpLua.Analyzers (AL) - Rules with Code Fixes
# =============================================================================
# Code fixes are automatically available when diagnostics are enabled.
# Severity must be at least 'suggestion' for IDE code fixes to appear.
# =============================================================================

# Errors - bugs that must be fixed (code fixes available)
dotnet_diagnostic.AL0001.severity = error # Primary constructor reassignment → fix: remove reassignment
dotnet_diagnostic.AL0003.severity = error # Division by zero → fix: add zero check
dotnet_diagnostic.AL0007.severity = error # GetSchema explicit impl → fix: make implicit
dotnet_diagnostic.AL0008.severity = error # GetSchema returns null → fix: return proper schema
dotnet_diagnostic.AL0009.severity = error # Don't call GetSchema → fix: remove call
dotnet_diagnostic.AL0020.severity = error # IFormCollection attribute → fix: add attribute
dotnet_diagnostic.AL0021.severity = error # Multiple form sources → fix: consolidate
dotnet_diagnostic.AL0022.severity = error # Mixed form collection/DTO → fix: separate
dotnet_diagnostic.AL0023.severity = error # Unsupported form type → fix: use supported type
dotnet_diagnostic.AL0024.severity = error # Form/body conflict → fix: remove conflict

# Warnings - should fix (code fixes available)
dotnet_diagnostic.AL0002.severity = warning # Repeated negated patterns → fix: simplify
dotnet_diagnostic.AL0004.severity = warning # Span pattern matching → fix: use span overload
dotnet_diagnostic.AL0005.severity = warning # Span SequenceEqual → fix: use SequenceEqual
dotnet_diagnostic.AL0006.severity = warning # Field/parameter name conflict → fix: rename
dotnet_diagnostic.AL0011.severity = warning # Lock on non-Lock → fix: use Lock type
dotnet_diagnostic.AL0012.severity = warning # Deprecated OTel convention → fix: use new convention
# AL0017: Hardcoded version - disabled for CPM projects
dotnet_diagnostic.AL0017.severity = none
# AL0018: Version.props not imported - disabled (qyl manages its own props)
dotnet_diagnostic.AL0018.severity = none
dotnet_diagnostic.AL0026.severity = warning # DateTime.Now/UtcNow
dotnet_diagnostic.AL0027.severity = warning # Newtonsoft.Json

# Suggestions - style preferences (code fixes available in IDE)
dotnet_diagnostic.AL0013.severity = suggestion # Missing schema URL → fix: add URL
dotnet_diagnostic.AL0014.severity = suggestion # Pattern matching style → fix: modernize pattern
dotnet_diagnostic.AL0015.severity = suggestion # Null-guard style → fix: use ArgumentNullException.ThrowIfNull
dotnet_diagnostic.AL0016.severity = suggestion # Declaration + null-check → fix: combine
dotnet_diagnostic.AL0025.severity = warning

# Disabled by default
dotnet_diagnostic.AL0010.severity = none # Type should be partial

# =============================================================================
# NAMING CONVENTIONS (Microsoft .NET Guidelines)
# https://learn.microsoft.com/en-us/dotnet/standard/design-guidelines/naming-guidelines
# =============================================================================

# Style definitions
dotnet_naming_style.pascal_case.capitalization = pascal_case

dotnet_naming_style.camel_case_underscore.required_prefix = _
dotnet_naming_style.camel_case_underscore.capitalization = camel_case

dotnet_naming_style.static_field_style.required_prefix = s_
dotnet_naming_style.static_field_style.capitalization = camel_case

# Rule 1: Constants must use PascalCase (highest priority)
dotnet_naming_rule.constants_should_be_pascal_case.severity = error
dotnet_naming_rule.constants_should_be_pascal_case.symbols = constant_fields
dotnet_naming_rule.constants_should_be_pascal_case.style = pascal_case
dotnet_naming_symbols.constant_fields.applicable_kinds = field
dotnet_naming_symbols.constant_fields.applicable_accessibilities = *
dotnet_naming_symbols.constant_fields.required_modifiers = const

# Rule 2: Static readonly fields should use PascalCase
dotnet_naming_rule.static_readonly_should_be_pascal_case.severity = warning
dotnet_naming_rule.static_readonly_should_be_pascal_case.symbols = static_readonly_fields
dotnet_naming_rule.static_readonly_should_be_pascal_case.style = pascal_case
dotnet_naming_symbols.static_readonly_fields.applicable_kinds = field
dotnet_naming_symbols.static_readonly_fields.applicable_accessibilities = *
dotnet_naming_symbols.static_readonly_fields.required_modifiers = static, readonly

# Rule 3: Private static fields should use s_camelCase
dotnet_naming_rule.private_static_fields_should_be_s_camel_case.severity = warning
dotnet_naming_rule.private_static_fields_should_be_s_camel_case.symbols = private_static_fields
dotnet_naming_rule.private_static_fields_should_be_s_camel_case.style = static_field_style
dotnet_naming_symbols.private_static_fields.applicable_kinds = field
dotnet_naming_symbols.private_static_fields.applicable_accessibilities = private
dotnet_naming_symbols.private_static_fields.required_modifiers = static

# Rule 4: Private instance fields must use _camelCase
dotnet_naming_rule.private_fields_should_be_camel_case.severity = error
dotnet_naming_rule.private_fields_should_be_camel_case.symbols = private_instance_fields
dotnet_naming_rule.private_fields_should_be_camel_case.style = camel_case_underscore
dotnet_naming_symbols.private_instance_fields.applicable_kinds = field
dotnet_naming_symbols.private_instance_fields.applicable_accessibilities = private

# Rule 5: Public/Internal fields should use PascalCase
dotnet_naming_rule.public_fields_should_be_pascal_case.severity = error
dotnet_naming_rule.public_fields_should_be_pascal_case.symbols = public_fields
dotnet_naming_rule.public_fields_should_be_pascal_case.style = pascal_case
dotnet_naming_symbols.public_fields.applicable_kinds = field
dotnet_naming_symbols.public_fields.applicable_accessibilities = public, internal, protected, protected_internal

# Rule 6: Namespaces - allow product name 'qyl' in lowercase (brand decision)
dotnet_naming_rule.namespaces_should_be_pascal_case.severity = suggestion
dotnet_naming_rule.namespaces_should_be_pascal_case.symbols = namespaces
dotnet_naming_rule.namespaces_should_be_pascal_case.style = pascal_case
dotnet_naming_symbols.namespaces.applicable_kinds = namespace

# =============================================================================
# GENERATED CODE EXCLUSIONS
# =============================================================================

[*.g.cs]
dotnet_analyzer_diagnostic.severity = none
dotnet_diagnostic.RS0030.severity = none
dotnet_diagnostic.RS0031.severity = none
generated_code = true

[*.generated.cs]
dotnet_analyzer_diagnostic.severity = none
dotnet_diagnostic.RS0030.severity = none
dotnet_diagnostic.RS0031.severity = none
generated_code = true

[**/obj/**/*.cs]
dotnet_analyzer_diagnostic.severity = none
dotnet_diagnostic.RS0030.severity = none
dotnet_diagnostic.RS0031.severity = none
generated_code = true

[**/Protos/**/*.cs]
dotnet_analyzer_diagnostic.severity = none
generated_code = true

[**/generated/**/*.cs]
dotnet_analyzer_diagnostic.severity = none
generated_code = true

# =============================================================================
# BUILD TOOLING (eng/build/)
# =============================================================================

[eng/build/**/*.cs]
dotnet_diagnostic.CA1822.severity = none # Static members not applicable
dotnet_diagnostic.CS0649.severity = none # Unassigned fields (Nuke DI)
dotnet_diagnostic.CS0169.severity = none # Unused fields (Nuke DI)
dotnet_diagnostic.CA1050.severity = none # Declare types in namespaces (Nuke)
dotnet_diagnostic.CA2211.severity = none # Non-constant fields (Nuke)
dotnet_diagnostic.IDE1006.severity = none # Naming (Nuke conventions)

dotnet_style_qualification_for_field = false:warning
dotnet_style_qualification_for_property = false:warning
dotnet_style_qualification_for_method = false:warning
dotnet_style_qualification_for_event = false:warning
dotnet_style_require_accessibility_modifiers = never:warning
csharp_style_expression_bodied_methods = true:silent
csharp_style_expression_bodied_properties = true:warning
csharp_style_expression_bodied_indexers = true:warning
csharp_style_expression_bodied_accessors = true:warning

# =============================================================================
# DTO/CONTRACT FILES (recursive globs)
# Per dotnet/roslyn-analyzers#1705: DTOs are legitimate exceptions
# =============================================================================

[src/**/Contracts/**/*.cs]
dotnet_diagnostic.CA1002.severity = none # List<T> for System.Text.Json
dotnet_diagnostic.CA1819.severity = none # Array properties in DTOs
dotnet_diagnostic.CA2227.severity = none # Collection properties settable

[src/**/*Dto.cs]
dotnet_diagnostic.CA1002.severity = none
dotnet_diagnostic.CA1819.severity = none
dotnet_diagnostic.CA2227.severity = none

[src/**/*Response.cs]
dotnet_diagnostic.CA1002.severity = none
dotnet_diagnostic.CA1819.severity = none

[src/**/*Request.cs]
dotnet_diagnostic.CA1002.severity = none
dotnet_diagnostic.CA1819.severity = none

# =============================================================================
# GRPC/PROTOBUF (recursive)
# =============================================================================

[src/**/Grpc/**/*.cs]
dotnet_diagnostic.CA1002.severity = none # List<T> for protobuf
dotnet_diagnostic.CA1819.severity = none # Arrays for protobuf

# =============================================================================
# INGESTION (recursive)
# =============================================================================

[src/**/Ingestion/**/*.cs]
dotnet_diagnostic.CA1002.severity = none # OTLP wire format

# =============================================================================
# STORAGE (recursive)
# =============================================================================

[src/**/Storage/**/*.cs]
dotnet_diagnostic.CA2100.severity = none # Parameterized queries - verified safe
dotnet_diagnostic.CA1034.severity = none # Nested types valid
dotnet_diagnostic.CA1002.severity = none # List<T> for batch operations
dotnet_diagnostic.CA1819.severity = none # Array properties for schema

[src/**/Query/**/*.cs]
dotnet_diagnostic.CA2100.severity = none # Parameterized queries - verified safe

# =============================================================================
# CONSOLE BRIDGE (recursive)
# =============================================================================

[src/**/ConsoleBridge/**/*.cs]
dotnet_diagnostic.CA1054.severity = none # Uri string param for JSON
dotnet_diagnostic.CA1056.severity = none # Uri string property for JSON

# =============================================================================
# SERIALIZER CONTEXT
# =============================================================================

[src/**/QylSerializerContext.cs]
dotnet_diagnostic.CA1002.severity = none
dotnet_diagnostic.CA1819.severity = none

# =============================================================================
# MAPPING (recursive)
# =============================================================================

[src/**/Mapping/**/*.cs]
dotnet_diagnostic.CA1002.severity = none # List<T> return for JSON DTOs

# =============================================================================
# MODELS (recursive)
# =============================================================================

[src/**/Models/**/*.cs]
dotnet_diagnostic.CA1002.severity = none # List<T> for attribute collection

# =============================================================================
# STARTUP BANNER
# =============================================================================

[src/**/StartupBanner.cs]
dotnet_diagnostic.CA1054.severity = none # String URL for display

# =============================================================================
# EXTENSIONS (recursive)
# =============================================================================

[src/**/Extensions/**/*.cs]
dotnet_diagnostic.CA1034.severity = none # Nested builder types

[src/**/*Extensions.cs]
dotnet_diagnostic.CA1034.severity = none # C# 14 extension blocks

# =============================================================================
# AUTH (recursive)
# =============================================================================

[src/**/Auth/**/*.cs]
dotnet_diagnostic.CA1819.severity = none # Byte array for token validation

# =============================================================================
# MCP (recursive)
# =============================================================================

[src/**/Mcp/**/*.cs]
dotnet_diagnostic.CA1819.severity = none # Tool definition arrays

# =============================================================================
# PROGRAM.CS
# =============================================================================

[src/**/Program.cs]
dotnet_diagnostic.QYL0002.severity = suggestion # Backward compat fallback

# =============================================================================
# TESTS
# =============================================================================

[tests/**/*.cs]
dotnet_diagnostic.CA1707.severity = none # Underscores in test names
dotnet_diagnostic.CA1816.severity = none # Dispose pattern
dotnet_diagnostic.CA2000.severity = none # Dispose objects
dotnet_diagnostic.VSTHRD111.severity = none # ConfigureAwait
dotnet_diagnostic.xUnit1004.severity = warning

# =============================================================================
# EXAMPLES
# =============================================================================

[examples/**/*.cs]
dotnet_diagnostic.CA1816.severity = none
dotnet_diagnostic.CA2000.severity = none
dotnet_diagnostic.VSTHRD111.severity = none

# =============================================================================
# FILE TYPES
# =============================================================================

[*.json]
indent_size = 2

[*.{yaml,yml}]
indent_size = 2

[*.md]
trim_trailing_whitespace = false

[*.{xml,props,targets,csproj,fsproj,vbproj}]
indent_size = 2