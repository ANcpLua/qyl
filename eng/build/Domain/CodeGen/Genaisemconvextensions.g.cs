// <auto-generated>
//     This code was generated by qyl.build (OTelSemconvGenerator).
//     Do not edit this file manually - changes will be overwritten.
//
//     Source:    eng/build/Domain/CodeGen/QylSchema.cs
//     Generator: OTelSemconvGenerator
//     Output:    Telemetry/GenAiSemconvExtensions.g.cs
//     Generated: 2024-12-17T14:00:00.0000000Z
// </auto-generated>

#nullable enable

using System;
using System.Buffers;

namespace qyl.collector.Telemetry;

/// <summary>
/// High-performance extension methods for GenAI attribute key matching.
/// Uses SearchValues&lt;string&gt; for efficient multi-prefix checks.
/// </summary>
public static class GenAiSemconvExtensions
{
    // ─────────────────────────────────────────────────────────────────────
    // SearchValues<string> for efficient prefix matching (.NET 10+)
    // ─────────────────────────────────────────────────────────────────────

    /// <summary>SearchValues for agent and tool prefixes.</summary>
    private static readonly SearchValues<string> AgentToolPrefixes =
        SearchValues.Create(["gen_ai.agent.", "gen_ai.tool."], StringComparison.Ordinal);

    /// <summary>SearchValues for all gen_ai.* sub-namespaces.</summary>
    private static readonly SearchValues<string> GenAiSubPrefixes =
        SearchValues.Create([
            "gen_ai.agent.",
            "gen_ai.tool.",
            "gen_ai.request.",
            "gen_ai.response.",
            "gen_ai.usage.",
            "gen_ai.evaluation.",
            "gen_ai.embeddings.",
            "gen_ai.data_source.",
            "gen_ai.input.",
            "gen_ai.output.",
        ], StringComparison.Ordinal);

    // ─────────────────────────────────────────────────────────────────────
    // STRING EXTENSION METHODS
    // ─────────────────────────────────────────────────────────────────────

    /// <summary>
    /// Checks if the key starts with "gen_ai." prefix.
    /// </summary>
    public static bool IsGenAiAttribute(this string key)
        => key.StartsWith("gen_ai.", StringComparison.Ordinal);

    /// <summary>
    /// Checks if the key is an agent or tool attribute using SearchValues.
    /// </summary>
    public static bool IsAgentOrToolAttribute(this string key)
        => AgentToolPrefixes.ContainsAny(key);

    /// <summary>
    /// Checks if the key matches any gen_ai.* sub-namespace using SearchValues.
    /// </summary>
    public static bool IsGenAiSubNamespace(this string key)
        => GenAiSubPrefixes.ContainsAny(key);

    /// <summary>
    /// Checks if the key is a deprecated attribute that needs migration.
    /// </summary>
    public static bool IsDeprecatedAttribute(this string key)
        => GenAiSemconv.Migrations.ContainsKey(key);

    /// <summary>
    /// Checks if the key is a legacy agents.* prefix attribute.
    /// </summary>
    public static bool IsLegacyAgentsAttribute(this string key)
        => key.StartsWith("agents.", StringComparison.Ordinal);

    // ─────────────────────────────────────────────────────────────────────
    // READONLYSPAN<BYTE> EXTENSION METHODS (for Utf8JsonReader)
    // ─────────────────────────────────────────────────────────────────────

    /// <summary>
    /// Checks if the UTF-8 key starts with "gen_ai." prefix.
    /// </summary>
    public static bool IsGenAiAttribute(this ReadOnlySpan<byte> key)
        => key.Length >= 7 && key[..7].SequenceEqual(GenAiSemconvUtf8.PrefixGenAi);

    /// <summary>
    /// Checks if the UTF-8 key is an agent or tool attribute.
    /// </summary>
    public static bool IsAgentOrToolAttribute(this ReadOnlySpan<byte> key)
    {
        if (key.Length < 13) return false;
        return key.StartsWith(GenAiSemconvUtf8.PrefixAgent) ||
               key.StartsWith(GenAiSemconvUtf8.PrefixTool);
    }

    /// <summary>
    /// Checks if the UTF-8 key starts with "agents." legacy prefix.
    /// </summary>
    public static bool IsLegacyAgentsAttribute(this ReadOnlySpan<byte> key)
        => key.Length >= 7 && key.StartsWith(GenAiSemconvUtf8.PrefixLegacyAgents);
}