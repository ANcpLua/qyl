using System;
using System.Globalization;
using System.Text;

namespace Domain.CodeGen;

/// <summary>
///     Centralized header generation for all code generators.
///     Provides consistent, machine-parseable headers that hooks can detect.
/// </summary>
public static class GeneratedFileHeaders
{
    /// <summary>
    ///     Schema source file path relative to repository root.
    /// </summary>
    public const string SchemaSource = "eng/build/Domain/CodeGen/QylSchema.cs";

    // ════════════════════════════════════════════════════════════════════════
    // C# Headers
    // ════════════════════════════════════════════════════════════════════════

    /// <summary>
    ///     Generates a C# file header with auto-generated marker.
    /// </summary>
    /// <param name="generatorName">Name of the generator (e.g., "CSharpGenerator")</param>
    /// <param name="outputFile">Relative path of the generated file</param>
    /// <returns>Complete header string</returns>
    public static string CSharp(string generatorName, string? outputFile = null)
    {
        var timestamp = DateTime.UtcNow;
        var sb = new StringBuilder();

        sb.AppendLine("// <auto-generated>");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     This code was generated by qyl.build ({generatorName}).");
        sb.AppendLine("//     Do not edit this file manually - changes will be overwritten.");
        sb.AppendLine("//");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     Source:    {SchemaSource}");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     Generator: {generatorName}");
        if (outputFile is not null)
            sb.AppendLine(CultureInfo.InvariantCulture, $"//     Output:    {outputFile}");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     Generated: {timestamp:O}");
        sb.AppendLine("// </auto-generated>");
        sb.AppendLine();
        sb.AppendLine("#nullable enable");
        sb.AppendLine();

        return sb.ToString();
    }

    // ════════════════════════════════════════════════════════════════════════
    // TypeScript Headers
    // ════════════════════════════════════════════════════════════════════════

    /// <summary>
    ///     Generates a TypeScript file header with auto-generated marker.
    /// </summary>
    public static string TypeScript(string generatorName, string? outputFile = null)
    {
        var timestamp = DateTime.UtcNow;
        var sb = new StringBuilder();

        sb.AppendLine("// <auto-generated>");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     This code was generated by qyl.build ({generatorName}).");
        sb.AppendLine("//     Do not edit this file manually - changes will be overwritten.");
        sb.AppendLine("//");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     Source:    {SchemaSource}");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     Generator: {generatorName}");
        if (outputFile is not null)
            sb.AppendLine(CultureInfo.InvariantCulture, $"//     Output:    {outputFile}");
        sb.AppendLine(CultureInfo.InvariantCulture, $"//     Generated: {timestamp:O}");
        sb.AppendLine("// </auto-generated>");
        sb.AppendLine();
        sb.AppendLine("/* eslint-disable */");
        sb.AppendLine("/* prettier-ignore */");
        sb.AppendLine();

        return sb.ToString();
    }

    // ════════════════════════════════════════════════════════════════════════
    // SQL Headers
    // ════════════════════════════════════════════════════════════════════════

    /// <summary>
    ///     Generates a SQL file header with auto-generated marker.
    /// </summary>
    public static string Sql(string generatorName, string? outputFile = null)
    {
        var timestamp = DateTime.UtcNow;
        var sb = new StringBuilder();

        sb.AppendLine("-- ═══════════════════════════════════════════════════════════════════════════════");
        sb.AppendLine("-- <auto-generated>");
        sb.AppendLine(CultureInfo.InvariantCulture,
            $"--     This schema was generated by qyl.build ({generatorName}).");
        sb.AppendLine("--     Do not edit this file manually - changes will be overwritten.");
        sb.AppendLine("--");
        sb.AppendLine(CultureInfo.InvariantCulture, $"--     Source:    {SchemaSource}");
        sb.AppendLine(CultureInfo.InvariantCulture, $"--     Generator: {generatorName}");
        if (outputFile is not null)
            sb.AppendLine(CultureInfo.InvariantCulture, $"--     Output:    {outputFile}");
        sb.AppendLine(CultureInfo.InvariantCulture, $"--     Generated: {timestamp:O}");
        sb.AppendLine("-- </auto-generated>");
        sb.AppendLine("-- ═══════════════════════════════════════════════════════════════════════════════");
        sb.AppendLine();

        return sb.ToString();
    }

    // ════════════════════════════════════════════════════════════════════════
    // JSON Headers (as comments are not standard, use wrapper)
    // ════════════════════════════════════════════════════════════════════════

    /// <summary>
    ///     Returns metadata for JSON files (to be stored in a companion .meta file or $schema).
    /// </summary>
    public static string JsonMeta(string generatorName)
    {
        var timestamp = DateTime.UtcNow;
        return $$"""
                 {
                   "$generated": {
                     "generator": "qyl.build ({{generatorName}})",
                     "source": "{{SchemaSource}}",
                     "timestamp": "{{timestamp:O}}",
                     "warning": "Do not edit manually - regenerate from QylSchema.cs"
                   }
                 }
                 """;
    }
}