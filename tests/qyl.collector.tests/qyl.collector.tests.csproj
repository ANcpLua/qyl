<Project Sdk="Microsoft.NET.Sdk.Web">
    <!-- Uses Microsoft.NET.Sdk.Web for WebApplicationFactory<T> integration testing.
         xunit.v3.mtp-v2 and MTP packages are inherited from tests/Directory.Build.props -->

    <PropertyGroup>
        <RootNamespace>qyl.collector.tests</RootNamespace>
        <!-- Not needed in .NET 10 with global.json "test": { "runner": "Microsoft.Testing.Platform" }
             but kept for explicit documentation -->
        <TestingPlatformDotnetTestSupport>true</TestingPlatformDotnetTestSupport>
    </PropertyGroup>

    <!-- Integration testing - WebApplicationFactory requires Microsoft.NET.Sdk.Web -->
    <ItemGroup>
        <PackageReference Include="Microsoft.AspNetCore.Mvc.Testing"/>
        <!-- Required for AddLatencyContext() extension in test factory -->
        <PackageReference Include="Microsoft.Extensions.Telemetry"/>
        <!-- DuckDB types for test assertions (not transitive from collector) -->
        <PackageReference Include="DuckDB.NET.Data.Full"/>
    </ItemGroup>

    <!-- Remove the ServiceDefaults interceptor generator from test compilation.
         The analyzer flows transitively from qyl.collector and generates interceptors
         for DbCommand calls, but test projects don't need instrumentation.
         We remove ALL analyzers from this package to prevent code generation. -->
    <Target Name="RemoveServiceDefaultsAnalyzer" BeforeTargets="CoreCompile">
        <ItemGroup>
            <Analyzer Remove="@(Analyzer)" Condition="$([System.String]::Copy('%(Analyzer.Identity)').Contains('ANcpSdk.AspNetCore.ServiceDefaults.AutoRegister'))" />
        </ItemGroup>
    </Target>

    <!-- Project dependencies -->
    <ItemGroup>
        <ProjectReference Include="../../src/qyl.collector/qyl.collector.csproj"/>
    </ItemGroup>

</Project>
