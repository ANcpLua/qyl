openapi: 3.1.0
info:
  title: QYL Telemetry API
  version: 0.0.0
tags:
  - name: Sessions
  - name: Traces
  - name: Spans
  - name: Streaming
  - name: Health
paths:
  /api/v1/live:
    get:
      operationId: Live_stream
      description: Server-Sent Events stream for real-time span updates
      parameters:
        - name: sessionId
          in: query
          required: false
          description: Filter by session ID
          schema:
            type: string
          explode: false
        - name: serviceName
          in: query
          required: false
          description: Filter by service name
          schema:
            type: string
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            text/event-stream:
              schema:
                type: string
      tags:
        - Streaming
  /api/v1/sessions:
    get:
      operationId: Sessions_list
      description: List all sessions with optional filters
      parameters:
        - $ref: '#/components/parameters/Api.PaginationParams.offset'
        - $ref: '#/components/parameters/Api.PaginationParams.limit'
        - $ref: '#/components/parameters/Api.TimeRangeParams.since'
        - $ref: '#/components/parameters/Api.TimeRangeParams.until'
        - name: serviceName
          in: query
          required: false
          description: Filter by service name
          schema:
            type: string
          explode: false
        - name: genAiSystem
          in: query
          required: false
          description: Filter by GenAI provider
          schema:
            type: string
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - offset
                  - limit
                  - hasMore
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Models.SessionSummary'
                    description: Items in current page
                  total:
                    type: integer
                    format: int64
                    description: Total count across all pages
                  offset:
                    type: integer
                    format: int64
                    description: Current page offset
                  limit:
                    type: integer
                    format: int64
                    description: Page size limit
                  hasMore:
                    type: boolean
                    description: Whether more items exist
                description: Paginated list response
        default:
          description: An unexpected error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Api.ApiError'
      tags:
        - Sessions
  /api/v1/sessions/{sessionId}:
    get:
      operationId: Sessions_get
      description: Get session by ID
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Primitives.SessionId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Models.SessionSummary'
        default:
          description: An unexpected error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Api.ApiError'
      tags:
        - Sessions
  /api/v1/sessions/{sessionId}/spans:
    get:
      operationId: Sessions_getSpans
      description: Get all spans for a session
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Primitives.SessionId'
        - $ref: '#/components/parameters/Api.PaginationParams.offset'
        - $ref: '#/components/parameters/Api.PaginationParams.limit'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - offset
                  - limit
                  - hasMore
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Models.SpanRecord'
                    description: Items in current page
                  total:
                    type: integer
                    format: int64
                    description: Total count across all pages
                  offset:
                    type: integer
                    format: int64
                    description: Current page offset
                  limit:
                    type: integer
                    format: int64
                    description: Page size limit
                  hasMore:
                    type: boolean
                    description: Whether more items exist
                description: Paginated list response
        default:
          description: An unexpected error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Api.ApiError'
      tags:
        - Sessions
  /api/v1/spans:
    get:
      operationId: Spans_list
      description: Query spans with filters
      parameters:
        - $ref: '#/components/parameters/Api.PaginationParams.offset'
        - $ref: '#/components/parameters/Api.PaginationParams.limit'
        - $ref: '#/components/parameters/Api.TimeRangeParams.since'
        - $ref: '#/components/parameters/Api.TimeRangeParams.until'
        - name: traceId
          in: query
          required: false
          description: Filter by trace ID
          schema:
            type: string
          explode: false
        - name: serviceName
          in: query
          required: false
          description: Filter by service name
          schema:
            type: string
          explode: false
        - name: name
          in: query
          required: false
          description: Filter by span name (supports wildcards)
          schema:
            type: string
          explode: false
        - name: status
          in: query
          required: false
          description: Filter by status (ok, error)
          schema:
            type: string
          explode: false
        - name: genAiSystem
          in: query
          required: false
          description: Filter by GenAI provider
          schema:
            type: string
          explode: false
        - name: genAiModel
          in: query
          required: false
          description: Filter by model
          schema:
            type: string
          explode: false
        - name: minDurationNs
          in: query
          required: false
          description: Minimum duration in nanoseconds
          schema:
            type: integer
            format: int64
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - offset
                  - limit
                  - hasMore
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Models.SpanRecord'
                    description: Items in current page
                  total:
                    type: integer
                    format: int64
                    description: Total count across all pages
                  offset:
                    type: integer
                    format: int64
                    description: Current page offset
                  limit:
                    type: integer
                    format: int64
                    description: Page size limit
                  hasMore:
                    type: boolean
                    description: Whether more items exist
                description: Paginated list response
        default:
          description: An unexpected error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Api.ApiError'
      tags:
        - Spans
  /api/v1/spans/{spanId}:
    get:
      operationId: Spans_get
      description: Get span by ID
      parameters:
        - name: spanId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Primitives.SpanId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Models.SpanRecord'
        default:
          description: An unexpected error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Api.ApiError'
      tags:
        - Spans
  /api/v1/traces/{traceId}:
    get:
      operationId: Traces_get
      description: Get trace tree by trace ID
      parameters:
        - name: traceId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Primitives.TraceId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Models.TraceNode'
        default:
          description: An unexpected error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Api.ApiError'
      tags:
        - Traces
  /api/v1/traces/{traceId}/spans:
    get:
      operationId: Traces_getSpans
      description: Get all spans for a trace
      parameters:
        - name: traceId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Primitives.TraceId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Models.SpanRecord'
        default:
          description: An unexpected error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Api.ApiError'
      tags:
        - Traces
  /health:
    get:
      operationId: Health_check
      description: Health check endpoint
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum:
                      - healthy
                  version:
                    type: string
                required:
                  - status
                  - version
      tags:
        - Health
components:
  parameters:
    Api.PaginationParams.limit:
      name: limit
      in: query
      required: false
      description: Maximum items to return
      schema:
        type: integer
        format: int64
        default: 100
      explode: false
    Api.PaginationParams.offset:
      name: offset
      in: query
      required: false
      description: Number of items to skip
      schema:
        type: integer
        format: int64
        default: 0
      explode: false
    Api.TimeRangeParams.since:
      name: since
      in: query
      required: false
      description: Start time (Unix nanoseconds)
      schema:
        type: integer
        format: int64
      explode: false
    Api.TimeRangeParams.until:
      name: until
      in: query
      required: false
      description: End time (Unix nanoseconds)
      schema:
        type: integer
        format: int64
      explode: false
  schemas:
    Api.ApiError:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Error code
        message:
          type: string
          description: Error message
        details:
          type: string
          description: Additional details
      description: Error response
    Enums.GenAiFinishReason:
      type: string
      enum:
        - stop
        - max_tokens
        - tool_calls
        - content_filter
        - error
      description: GenAI finish reason
      x-csharp-type: string
      x-duckdb-type: VARCHAR
    Enums.GenAiOperationName:
      type: string
      enum:
        - chat
        - completion
        - embedding
        - image_generation
        - text_to_speech
        - speech_to_text
        - invoke_agent
        - execute_tool
      description: GenAI operation name
      x-csharp-type: string
      x-duckdb-type: VARCHAR
    Enums.SeverityNumber:
      type: number
      enum:
        - 0
        - 1
        - 5
        - 9
        - 13
        - 17
        - 21
      description: Log severity number following OTel specification (1-24)
      x-csharp-type: SeverityNumber
      x-duckdb-type: TINYINT
    Enums.SpanKind:
      type: number
      enum:
        - 0
        - 1
        - 2
        - 3
        - 4
        - 5
      description: Span kind describing the relationship between spans
      x-csharp-type: SpanKind
      x-duckdb-type: TINYINT
    Enums.StatusCode:
      type: number
      enum:
        - 0
        - 1
        - 2
      description: Span status code
      x-csharp-type: StatusCode
      x-duckdb-type: TINYINT
    Models.GenAiSpanData:
      type: object
      properties:
        system:
          type: string
          description: Provider/system name
        requestModel:
          type: string
          description: Requested model
        responseModel:
          type: string
          description: Response model
        inputTokens:
          allOf:
            - $ref: '#/components/schemas/Primitives.TokenCount'
          description: Input tokens
        outputTokens:
          allOf:
            - $ref: '#/components/schemas/Primitives.TokenCount'
          description: Output tokens
        temperature:
          allOf:
            - $ref: '#/components/schemas/Primitives.Temperature'
          description: Temperature
        stopReason:
          type: string
          description: Finish reason
        toolName:
          type: string
          description: Tool name
        toolCallId:
          type: string
          description: Tool call ID
        costUsd:
          allOf:
            - $ref: '#/components/schemas/Primitives.CostUsd'
          description: Estimated cost
      description: Extracted GenAI attributes from a span
      x-csharp-type: GenAiSpanData
    Models.SessionSummary:
      type: object
      required:
        - sessionId
        - startTime
        - endTime
        - spanCount
        - errorCount
        - totalInputTokens
        - totalOutputTokens
        - totalCostUsd
      properties:
        sessionId:
          allOf:
            - $ref: '#/components/schemas/Primitives.SessionId'
          description: Session identifier
          x-duckdb-primary-key: true
          x-duckdb-column: session_id
        startTime:
          allOf:
            - $ref: '#/components/schemas/Primitives.UnixNano'
          description: First span timestamp
          x-duckdb-column: start_time
        endTime:
          allOf:
            - $ref: '#/components/schemas/Primitives.UnixNano'
          description: Last span timestamp
          x-duckdb-column: end_time
        spanCount:
          allOf:
            - $ref: '#/components/schemas/Primitives.Count'
          description: Total span count
          x-duckdb-column: span_count
        errorCount:
          allOf:
            - $ref: '#/components/schemas/Primitives.Count'
          description: Error span count
          x-duckdb-column: error_count
        totalInputTokens:
          allOf:
            - $ref: '#/components/schemas/Primitives.TokenCount'
          description: Total input tokens
          x-duckdb-column: total_input_tokens
        totalOutputTokens:
          allOf:
            - $ref: '#/components/schemas/Primitives.TokenCount'
          description: Total output tokens
          x-duckdb-column: total_output_tokens
        totalCostUsd:
          allOf:
            - $ref: '#/components/schemas/Primitives.CostUsd'
          description: Total cost in USD
          x-duckdb-column: total_cost_usd
        serviceName:
          type: string
          description: Primary service name
          x-duckdb-column: service_name
        genAiSystem:
          type: string
          description: Primary GenAI provider
          x-duckdb-column: gen_ai_system
        genAiModel:
          type: string
          description: Primary model used
          x-duckdb-column: gen_ai_model
      description: Session summary with aggregated metrics
      x-csharp-type: SessionSummary
      x-duckdb-table: sessions
    Models.SpanRecord:
      type: object
      required:
        - spanId
        - traceId
        - name
        - kind
        - startTimeUnixNano
        - endTimeUnixNano
        - durationNs
        - statusCode
      properties:
        spanId:
          allOf:
            - $ref: '#/components/schemas/Primitives.SpanId'
          description: Unique span identifier
          x-duckdb-primary-key: true
          x-duckdb-column: span_id
        traceId:
          allOf:
            - $ref: '#/components/schemas/Primitives.TraceId'
          description: Trace identifier
          x-duckdb-index: idx_spans_trace_id
          x-duckdb-column: trace_id
        parentSpanId:
          allOf:
            - $ref: '#/components/schemas/Primitives.SpanId'
          description: Parent span identifier (null for root spans)
          x-duckdb-column: parent_span_id
        sessionId:
          allOf:
            - $ref: '#/components/schemas/Primitives.SessionId'
          description: Session identifier for grouping related traces
          x-promoted: true
          x-duckdb-index: idx_spans_session_id
          x-duckdb-column: session_id
        name:
          type: string
          minLength: 1
          description: Human-readable span name
          x-duckdb-column: name
        kind:
          allOf:
            - $ref: '#/components/schemas/Enums.SpanKind'
          description: Span kind
          x-duckdb-column: kind
        startTimeUnixNano:
          allOf:
            - $ref: '#/components/schemas/Primitives.UnixNano'
          description: Start timestamp in nanoseconds since epoch
          x-duckdb-index: idx_spans_start_time
          x-duckdb-column: start_time_unix_nano
        endTimeUnixNano:
          allOf:
            - $ref: '#/components/schemas/Primitives.UnixNano'
          description: End timestamp in nanoseconds since epoch
          x-duckdb-column: end_time_unix_nano
        durationNs:
          allOf:
            - $ref: '#/components/schemas/Primitives.DurationNs'
          description: Duration in nanoseconds
          x-duckdb-column: duration_ns
        statusCode:
          allOf:
            - $ref: '#/components/schemas/Enums.StatusCode'
          description: Span status code
          x-duckdb-column: status_code
        statusMessage:
          type: string
          description: Status message (only for ERROR status)
          x-duckdb-column: status_message
        serviceName:
          type: string
          description: Service name from resource attributes
          x-promoted: true
          x-duckdb-index: idx_spans_service_name
          x-duckdb-column: service_name
        genAiSystem:
          type: string
          description: GenAI provider/system (e.g., openai, anthropic)
          x-promoted: true
          x-duckdb-column: gen_ai_system
        genAiRequestModel:
          type: string
          description: Requested model name
          x-promoted: true
          x-duckdb-column: gen_ai_request_model
        genAiResponseModel:
          type: string
          description: Actual response model name
          x-promoted: true
          x-duckdb-column: gen_ai_response_model
        genAiInputTokens:
          allOf:
            - $ref: '#/components/schemas/Primitives.TokenCount'
          description: Input/prompt tokens
          x-promoted: true
          x-duckdb-column: gen_ai_input_tokens
        genAiOutputTokens:
          allOf:
            - $ref: '#/components/schemas/Primitives.TokenCount'
          description: Output/completion tokens
          x-promoted: true
          x-duckdb-column: gen_ai_output_tokens
        genAiTemperature:
          allOf:
            - $ref: '#/components/schemas/Primitives.Temperature'
          description: Request temperature
          x-promoted: true
          x-duckdb-column: gen_ai_temperature
        genAiStopReason:
          type: string
          description: Response finish reason
          x-promoted: true
          x-duckdb-column: gen_ai_stop_reason
        genAiToolName:
          type: string
          description: Tool name for tool calls
          x-promoted: true
          x-duckdb-column: gen_ai_tool_name
        genAiToolCallId:
          type: string
          description: Tool call ID
          x-promoted: true
          x-duckdb-column: gen_ai_tool_call_id
        genAiCostUsd:
          allOf:
            - $ref: '#/components/schemas/Primitives.CostUsd'
          description: Estimated cost in USD
          x-promoted: true
          x-duckdb-column: gen_ai_cost_usd
        attributesJson:
          type: string
          description: All span attributes as JSON
          x-duckdb-type: VARCHAR
          x-duckdb-column: attributes_json
        resourceJson:
          type: string
          description: Resource attributes as JSON
          x-duckdb-type: VARCHAR
          x-duckdb-column: resource_json
        createdAt:
          type: string
          format: date-time
          description: Row creation timestamp
          x-internal: true
          x-duckdb-type: TIMESTAMP DEFAULT now()
          x-duckdb-column: created_at
      description: OpenTelemetry span record for storage and query
      x-csharp-type: SpanRecord
      x-duckdb-table: spans
    Models.TraceNode:
      type: object
      required:
        - span
        - children
        - depth
      properties:
        span:
          allOf:
            - $ref: '#/components/schemas/Models.SpanRecord'
          description: Span data
        children:
          type: array
          items:
            $ref: '#/components/schemas/Models.TraceNode'
          description: Child spans
        depth:
          type: integer
          format: int32
          description: Depth in tree (0 = root)
      description: Trace tree node for hierarchical span display
      x-csharp-type: TraceNode
    Primitives.CostUsd:
      type: number
      format: double
      minimum: 0
      description: Cost in USD (floating point)
      x-csharp-type: double
      x-duckdb-type: DOUBLE
    Primitives.Count:
      type: integer
      format: int64
      minimum: 0
      description: Generic non-negative counter
      x-csharp-type: long
      x-duckdb-type: BIGINT
    Primitives.DurationNs:
      type: integer
      format: int64
      minimum: 0
      description: Duration in nanoseconds
      x-csharp-type: long
      x-duckdb-type: UBIGINT
    Primitives.SessionId:
      type: string
      minLength: 32
      maxLength: 32
      pattern: ^[a-f0-9]{32}$
      description: Session identifier (GUID without hyphens)
      examples:
        - 550e8400e29b41d4a716446655440000
      x-csharp-type: SessionId
      x-csharp-struct: true
      x-duckdb-type: VARCHAR(32)
    Primitives.SpanId:
      type: string
      minLength: 16
      maxLength: 16
      pattern: ^[a-f0-9]{16}$
      description: Unique span identifier (16 lowercase hex characters)
      examples:
        - b7ad6b7169203331
      x-csharp-type: SpanId
      x-csharp-struct: true
      x-duckdb-type: VARCHAR(16)
    Primitives.Temperature:
      type: number
      format: double
      minimum: 0
      maximum: 2
      description: Temperature setting for LLM requests (0.0-2.0)
      x-csharp-type: double
      x-duckdb-type: DOUBLE
    Primitives.TokenCount:
      type: integer
      format: int64
      minimum: 0
      description: Token count for LLM operations
      x-csharp-type: long
      x-duckdb-type: BIGINT
    Primitives.TraceId:
      type: string
      minLength: 32
      maxLength: 32
      pattern: ^[a-f0-9]{32}$
      description: Unique trace identifier (32 lowercase hex characters)
      examples:
        - 0af7651916cd43dd8448eb211c80319c
      x-csharp-type: TraceId
      x-csharp-struct: true
      x-duckdb-type: VARCHAR(32)
    Primitives.UnixNano:
      type: integer
      format: int64
      minimum: 0
      description: Unix timestamp in nanoseconds since epoch
      x-ts-type: number
      x-csharp-type: UnixNano
      x-csharp-struct: true
      x-duckdb-type: UBIGINT
servers:
  - url: http://localhost:5100
    description: QYL Collector
    variables: {}
