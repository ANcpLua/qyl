openapi: 3.1.0
info:
  title: QYL Collector API
  version: 1.0.0
tags:
  - name: OTLP
  - name: Health
  - name: Auth
  - name: Sessions
  - name: Traces
  - name: Ingestion
  - name: Console
  - name: Streaming
  - name: MCP
paths:
  /api/auth/check:
    get:
      operationId: Api_authCheck
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthCheckResponse'
      tags:
        - Auth
  /api/login:
    post:
      operationId: Api_login
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
  /api/logout:
    post:
      operationId: Api_logout
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                required:
                  - success
      tags:
        - Auth
  /api/v1/console:
    post:
      operationId: Api_ingestConsoleLogs
      parameters: []
      responses:
        '202':
          description: The request has been accepted for processing, but processing has not yet completed.
      tags:
        - Console
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConsoleIngestBatch'
    get:
      operationId: Api_getConsoleLogs
      parameters:
        - name: session
          in: query
          required: false
          schema:
            type: string
          explode: false
        - name: level
          in: query
          required: false
          schema:
            type: string
          explode: false
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            format: int32
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConsoleLogEntry'
      tags:
        - Console
  /api/v1/console/errors:
    get:
      operationId: Api_getConsoleErrors
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            format: int32
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConsoleLogEntry'
      tags:
        - Console
  /api/v1/console/live:
    get:
      operationId: Api_liveConsole
      parameters:
        - name: session
          in: query
          required: false
          schema:
            type: string
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SseConnectedEvent'
      tags:
        - Streaming
  /api/v1/feedback:
    post:
      operationId: Api_submitFeedback
      parameters: []
      responses:
        '202':
          description: The request has been accepted for processing, but processing has not yet completed.
      tags:
        - Ingestion
  /api/v1/ingest:
    post:
      operationId: Api_ingestSpans
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '202':
          description: The request has been accepted for processing, but processing has not yet completed.
      tags:
        - Ingestion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SpanBatch'
  /api/v1/live:
    get:
      operationId: Api_liveStream
      parameters:
        - name: session
          in: query
          required: false
          schema:
            type: string
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SseConnectedEvent'
      tags:
        - Streaming
  /api/v1/sessions:
    get:
      operationId: Api_listSessions
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            format: int32
          explode: false
        - name: serviceName
          in: query
          required: false
          schema:
            type: string
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionListResponse'
      tags:
        - Sessions
  /api/v1/sessions/{sessionId}:
    get:
      operationId: Api_getSession
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/SessionId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Sessions
  /api/v1/sessions/{sessionId}/feedback:
    get:
      operationId: Api_getSessionFeedback
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/SessionId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeedbackResponse'
      tags:
        - Sessions
  /api/v1/sessions/{sessionId}/spans:
    get:
      operationId: Api_getSessionSpans
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/SessionId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpanListResponse'
      tags:
        - Sessions
  /api/v1/traces/{traceId}:
    get:
      operationId: Api_getTrace
      parameters:
        - name: traceId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/TraceId'
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TraceResponse'
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Traces
  /health:
    get:
      operationId: health
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
        - Health
  /mcp/manifest:
    get:
      operationId: Mcp_getManifest
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpManifest'
      tags:
        - MCP
  /mcp/tools/call:
    post:
      operationId: Mcp_callTool
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpResponse'
      tags:
        - MCP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/McpToolCall'
  /ready:
    get:
      operationId: ready
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
        - Health
  /v1/traces:
    post:
      operationId: otlpIngest
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '202':
          description: The request has been accepted for processing, but processing has not yet completed.
      tags:
        - OTLP
      requestBody:
        required: true
        content:
          application/json:
            schema: {}
components:
  schemas:
    Attributes:
      type: object
      unevaluatedProperties: {}
      description: Key-value attributes map
    AuthCheckResponse:
      type: object
      required:
        - authenticated
      properties:
        authenticated:
          type: boolean
      description: Auth check response
    ConsoleIngestBatch:
      type: object
      required:
        - logs
      properties:
        logs:
          type: array
          items:
            $ref: '#/components/schemas/ConsoleIngestRequest'
      description: Console log batch
    ConsoleIngestRequest:
      type: object
      properties:
        level:
          type: string
        message:
          type: string
        sessionId:
          type: string
        url:
          type: string
        stack:
          type: string
      description: Console log ingest request
    ConsoleLevel:
      type: string
      enum:
        - debug
        - log
        - info
        - warn
        - error
      description: Console log level
    ConsoleLogEntry:
      type: object
      required:
        - timestamp
      properties:
        level:
          $ref: '#/components/schemas/ConsoleLevel'
        message:
          type: string
        sessionId:
          type: string
        url:
          type: string
        stack:
          type: string
        timestamp:
          $ref: '#/components/schemas/Timestamp'
      description: Console log entry
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
        message:
          type: string
      description: Error response
    FeedbackResponse:
      type: object
      required:
        - feedback
      properties:
        feedback:
          type: array
          items: {}
      description: Feedback response (placeholder)
    GenAiSpanData:
      type: object
      properties:
        providerName:
          type: string
        operationName:
          type: string
        requestModel:
          type: string
        responseModel:
          type: string
        inputTokens:
          type: integer
          format: int64
        outputTokens:
          type: integer
          format: int64
        totalTokens:
          type: integer
          format: int64
        costUsd:
          type: number
          format: double
        temperature:
          type: number
          format: double
        maxTokens:
          type: integer
          format: int32
        finishReason:
          type: string
        toolName:
          type: string
        toolCallId:
          type: string
      description: GenAI-specific span data (OTel semconv 1.38)
    HealthResponse:
      type: object
      required:
        - status
      properties:
        status:
          type: string
      description: Health response
    LoginRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
      description: Login request
    LoginResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
        error:
          type: string
      description: Login response
    McpContent:
      type: object
      required:
        - type
      properties:
        type:
          type: string
        text:
          type: string
      description: MCP content
    McpManifest:
      type: object
      required:
        - name
        - version
        - description
        - tools
      properties:
        name:
          type: string
        version:
          type: string
        description:
          type: string
        tools:
          type: array
          items:
            $ref: '#/components/schemas/McpTool'
      description: MCP manifest
    McpResponse:
      type: object
      required:
        - isError
      properties:
        content:
          $ref: '#/components/schemas/McpContent'
        error:
          type: string
        isError:
          type: boolean
      description: MCP response
    McpTool:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
        description:
          type: string
        inputSchema: {}
      description: MCP tool definition
    McpToolCall:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        arguments: {}
      description: MCP tool call
    Session:
      type: object
      required:
        - sessionId
        - startTime
        - lastActivity
        - durationMs
        - spanCount
        - traceCount
        - errorCount
        - errorRate
        - services
        - traceIds
        - genaiStats
      properties:
        sessionId:
          $ref: '#/components/schemas/SessionId'
        startTime:
          $ref: '#/components/schemas/Timestamp'
        lastActivity:
          $ref: '#/components/schemas/Timestamp'
        durationMs:
          type: number
          format: double
        spanCount:
          type: integer
          format: int64
        traceCount:
          type: integer
          format: int64
        errorCount:
          type: integer
          format: int64
        errorRate:
          type: number
          format: double
        services:
          type: array
          items:
            type: string
        traceIds:
          type: array
          items:
            type: string
        isActive:
          type: boolean
        genaiStats:
          $ref: '#/components/schemas/SessionGenAiStats'
        attributes:
          $ref: '#/components/schemas/Attributes'
      description: AI conversation session with aggregated metrics
    SessionGenAiStats:
      type: object
      required:
        - totalInputTokens
        - totalOutputTokens
        - totalTokens
        - totalCostUsd
        - requestCount
        - toolCallCount
        - models
        - providers
      properties:
        totalInputTokens:
          type: integer
          format: int64
        totalOutputTokens:
          type: integer
          format: int64
        totalTokens:
          type: integer
          format: int64
        totalCostUsd:
          type: number
          format: double
        requestCount:
          type: integer
          format: int64
        toolCallCount:
          type: integer
          format: int64
        models:
          type: array
          items:
            type: string
        providers:
          type: array
          items:
            type: string
        primaryModel:
          type: string
      description: GenAI statistics aggregated at session level
    SessionId:
      type: string
      description: Session identifier (GUID format)
    SessionListResponse:
      type: object
      required:
        - sessions
        - total
        - hasMore
      properties:
        sessions:
          type: array
          items:
            $ref: '#/components/schemas/Session'
        total:
          type: integer
          format: int32
        hasMore:
          type: boolean
      description: Session list response
    Span:
      type: object
      required:
        - traceId
        - spanId
        - name
        - kind
        - status
        - startTime
        - endTime
        - durationMs
        - serviceName
      properties:
        traceId:
          $ref: '#/components/schemas/TraceId'
        spanId:
          $ref: '#/components/schemas/SpanId'
        parentSpanId:
          $ref: '#/components/schemas/SpanId'
        sessionId:
          $ref: '#/components/schemas/SessionId'
        name:
          type: string
        kind:
          $ref: '#/components/schemas/SpanKind'
        status:
          $ref: '#/components/schemas/SpanStatus'
        statusMessage:
          type: string
        startTime:
          $ref: '#/components/schemas/Timestamp'
        endTime:
          $ref: '#/components/schemas/Timestamp'
        durationMs:
          type: number
          format: double
        serviceName:
          type: string
        serviceVersion:
          type: string
        attributes:
          $ref: '#/components/schemas/Attributes'
        events:
          type: array
          items:
            $ref: '#/components/schemas/SpanEvent'
        links:
          type: array
          items:
            $ref: '#/components/schemas/SpanLink'
        genai:
          allOf:
            - $ref: '#/components/schemas/GenAiSpanData'
          description: GenAI-specific data if this is an AI span
      description: OpenTelemetry span
    SpanBatch:
      type: object
      required:
        - spans
      properties:
        spans:
          type: array
          items:
            $ref: '#/components/schemas/Span'
      description: Span batch for ingestion
    SpanEvent:
      type: object
      required:
        - name
        - timestamp
      properties:
        name:
          type: string
        timestamp:
          $ref: '#/components/schemas/Timestamp'
        attributes:
          $ref: '#/components/schemas/Attributes'
      description: Span event (log attached to span)
    SpanId:
      type: string
      description: 16-character hex span ID
    SpanKind:
      type: string
      enum:
        - internal
        - server
        - client
        - producer
        - consumer
      description: OpenTelemetry span kind
    SpanLink:
      type: object
      required:
        - traceId
        - spanId
      properties:
        traceId:
          $ref: '#/components/schemas/TraceId'
        spanId:
          $ref: '#/components/schemas/SpanId'
        attributes:
          $ref: '#/components/schemas/Attributes'
      description: Span link (cross-trace reference)
    SpanListResponse:
      type: object
      required:
        - spans
      properties:
        spans:
          type: array
          items:
            $ref: '#/components/schemas/Span'
      description: Span list response
    SpanStatus:
      type: string
      enum:
        - unset
        - ok
        - error
      description: OpenTelemetry span status
    SseConnectedEvent:
      type: object
      required:
        - connectionId
      properties:
        connectionId:
          type: string
      description: SSE connected event
    SseErrorData:
      type: object
      required:
        - errorType
        - message
      properties:
        errorType:
          type: string
        message:
          type: string
      description: SSE error data
    StorageStats:
      type: object
      required:
        - spanCount
        - sessionCount
        - feedbackCount
      properties:
        spanCount:
          type: integer
          format: int64
        sessionCount:
          type: integer
          format: int64
        feedbackCount:
          type: integer
          format: int64
        oldestSpan:
          $ref: '#/components/schemas/Timestamp'
        newestSpan:
          $ref: '#/components/schemas/Timestamp'
      description: Storage statistics
    Timestamp:
      type: string
      description: ISO 8601 timestamp
    TraceId:
      type: string
      description: 32-character hex trace ID (OTel W3C format)
    TraceResponse:
      type: object
      required:
        - spans
      properties:
        traceId:
          $ref: '#/components/schemas/TraceId'
        spans:
          type: array
          items:
            $ref: '#/components/schemas/Span'
        rootSpan:
          $ref: '#/components/schemas/Span'
        durationMs:
          type: number
          format: double
        status:
          type: string
      description: Trace response with hierarchy
servers:
  - url: http://localhost:5100
    description: QYL Collector
    variables: {}
